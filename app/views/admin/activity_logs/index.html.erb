<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0" style="font-weight: 600; color: #1d1d1f;">
      <i class="bi bi-activity me-2" style="color: #0071e3;"></i>
      활동 로그
    </h2>
  </div>

  <!-- 필터 -->
  <div class="card mb-4" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <div class="card-body">
      <%= form_with url: admin_activity_logs_path, method: :get, local: true, class: "row g-3 align-items-end" do %>
        <div class="col-md-2">
          <label class="form-label" style="font-size: 0.85rem; font-weight: 600; color: #6e6e73;">사용자</label>
          <%= select_tag :user_id,
              options_from_collection_for_select(@users, :id, :name, params[:user_id]),
              include_blank: "전체",
              class: "form-select form-select-sm" %>
        </div>

        <div class="col-md-2">
          <label class="form-label" style="font-size: 0.85rem; font-weight: 600; color: #6e6e73;">액션</label>
          <%= select_tag :action_type,
              options_for_select([["전체", ""], ["생성", "create"], ["수정", "update"], ["삭제", "destroy"]], params[:action_type]),
              class: "form-select form-select-sm" %>
        </div>

        <div class="col-md-2">
          <label class="form-label" style="font-size: 0.85rem; font-weight: 600; color: #6e6e73;">대상</label>
          <%= select_tag :target_type,
              options_for_select([["전체", ""]] + @target_types.map { |k, v| [v, k] }, params[:target_type]),
              class: "form-select form-select-sm" %>
        </div>

        <div class="col-md-2">
          <label class="form-label" style="font-size: 0.85rem; font-weight: 600; color: #6e6e73;">날짜</label>
          <%= date_field_tag :date, params[:date], class: "form-control form-control-sm" %>
        </div>

        <div class="col-md-4">
          <%= submit_tag "검색", class: "btn btn-primary btn-sm me-2" %>
          <%= link_to "초기화", admin_activity_logs_path, class: "btn btn-outline-secondary btn-sm" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- 활동 로그 목록 -->
  <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <div class="card-header" style="background-color: #f5f5f7; border-bottom: 1px solid #e8e8ed; padding: 1rem 1.5rem;">
      <h5 class="mb-0" style="font-weight: 600; color: #1d1d1f;">
        활동 내역
        <span class="badge bg-secondary ms-2" style="font-size: 0.7rem;"><%= @total_count %>건</span>
      </h5>
    </div>
    <div class="card-body p-0">
      <% if @activity_logs.any? %>
        <div class="table-responsive">
          <table class="table table-hover mb-0" style="font-size: 0.95rem;">
            <thead style="background-color: #f5f5f7; border-bottom: 2px solid #e8e8ed;">
              <tr>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">시간</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">사용자</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">액션</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">대상</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">IP</th>
              </tr>
            </thead>
            <tbody>
              <% @activity_logs.each do |log| %>
                <tr>
                  <td style="padding: 1rem; color: #1d1d1f;">
                    <%= log.performed_at.strftime('%Y-%m-%d') %>
                    <br>
                    <small style="color: #6e6e73;"><%= log.performed_at.strftime('%H:%M:%S') %></small>
                  </td>
                  <td style="padding: 1rem;">
                    <div class="d-flex align-items-center">
                      <div class="rounded-circle d-flex align-items-center justify-content-center me-2"
                           style="width: 32px; height: 32px; background-color: #e3f2fd;">
                        <span style="color: #0071e3; font-weight: 600; font-size: 0.85rem;">
                          <%= log.user.name&.first || log.user.email.first.upcase %>
                        </span>
                      </div>
                      <div>
                        <div style="font-weight: 500; color: #1d1d1f;"><%= log.user.name || log.user.email %></div>
                      </div>
                    </div>
                  </td>
                  <td class="text-center" style="padding: 1rem;">
                    <% case log.action %>
                    <% when "create" %>
                      <span class="badge" style="background-color: #34c759;">
                        <i class="bi bi-plus-circle me-1"></i>생성
                      </span>
                    <% when "update" %>
                      <span class="badge" style="background-color: #0071e3;">
                        <i class="bi bi-pencil me-1"></i>수정
                      </span>
                    <% when "destroy" %>
                      <span class="badge" style="background-color: #ff3b30;">
                        <i class="bi bi-trash me-1"></i>삭제
                      </span>
                    <% end %>
                  </td>
                  <td style="padding: 1rem;">
                    <div style="font-weight: 500; color: #1d1d1f;"><%= log.target_type_name %></div>
                    <small style="color: #6e6e73;"><%= truncate(log.target_name, length: 40) %></small>
                  </td>
                  <td style="padding: 1rem; color: #6e6e73;">
                    <% if log.ip_address.present? %>
                      <i class="bi bi-geo-alt me-1"></i><%= log.ip_address %>
                    <% else %>
                      <span style="color: #c7c7cc;">-</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-inbox" style="font-size: 3rem; color: #c7c7cc;"></i>
          <p class="mt-3 mb-0" style="color: #6e6e73;">활동 로그가 없습니다.</p>
        </div>
      <% end %>
    </div>

    <!-- 페이지네이션 -->
    <% if @total_pages > 1 %>
      <div class="card-footer" style="background-color: #f5f5f7; border-top: 1px solid #e8e8ed; padding: 1rem;">
        <div class="d-flex justify-content-center align-items-center gap-3">
          <% if @page > 1 %>
            <%= link_to admin_activity_logs_path(page: @page - 1, user_id: params[:user_id], action_type: params[:action_type], target_type: params[:target_type], date: params[:date]), class: "btn btn-sm btn-outline-secondary" do %>
              <i class="bi bi-chevron-left"></i> 이전
            <% end %>
          <% end %>

          <span style="color: #6e6e73; font-size: 0.9rem;">
            <%= @page %> / <%= @total_pages %> 페이지
          </span>

          <% if @page < @total_pages %>
            <%= link_to admin_activity_logs_path(page: @page + 1, user_id: params[:user_id], action_type: params[:action_type], target_type: params[:target_type], date: params[:date]), class: "btn btn-sm btn-outline-secondary" do %>
              다음 <i class="bi bi-chevron-right"></i>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
