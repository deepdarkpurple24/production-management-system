<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0" style="font-weight: 600; color: #1d1d1f;">
      <i class="bi bi-people-fill me-2" style="color: #0071e3;"></i>
      사용자 관리
    </h2>
    <%= link_to new_admin_user_path, class: "btn-apple btn-apple-primary" do %>
      <i class="bi bi-plus-circle me-2"></i>신규 사용자 추가
    <% end %>
  </div>

  <!-- 통계 카드 -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-size: 0.85rem;">전체 사용자</h6>
          <h3 class="mb-0" style="color: #0071e3; font-weight: 600;"><%= @users.count %></h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-size: 0.85rem;">관리자</h6>
          <h3 class="mb-0" style="color: #34c759; font-weight: 600;"><%= @users.select(&:admin?).count %></h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-size: 0.85rem;">일반 사용자</h6>
          <h3 class="mb-0" style="color: #6e6e73; font-weight: 600;"><%= @users.reject(&:admin?).count %></h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-size: 0.85rem;">오늘 로그인</h6>
          <h3 class="mb-0" style="color: #ff9500; font-weight: 600;"><%= LoginHistory.successful.today.distinct.count(:user_id) %></h3>
        </div>
      </div>
    </div>
  </div>

  <!-- 사용자 목록 -->
  <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <div class="card-header" style="background-color: #f5f5f7; border-bottom: 1px solid #e8e8ed; padding: 1rem 1.5rem;">
      <h5 class="mb-0" style="font-weight: 600; color: #1d1d1f;">사용자 목록</h5>
    </div>
    <div class="card-body p-0">
      <% if @users.any? %>
        <div class="table-responsive">
          <table class="table table-hover mb-0" style="font-size: 0.95rem;">
            <thead style="background-color: #f5f5f7; border-bottom: 2px solid #e8e8ed;">
              <tr>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">이름</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">이메일</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">권한</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">승인된 디바이스</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">로그인 횟수</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">마지막 로그인</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">가입일</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">작업</th>
              </tr>
            </thead>
            <tbody>
              <% @users.each do |user| %>
                <tr>
                  <td style="padding: 1rem;">
                    <div style="font-weight: 500; color: #1d1d1f;">
                      <%= user.name %>
                      <% if user == current_user %>
                        <span class="badge bg-info ms-2" style="font-size: 0.7rem;">나</span>
                      <% end %>
                    </div>
                  </td>
                  <td style="padding: 1rem; color: #6e6e73;">
                    <%= user.email %>
                  </td>
                  <td class="text-center" style="padding: 1rem;">
                    <% if user.admin? %>
                      <span class="badge" style="background-color: #34c759; font-size: 0.85rem;">
                        <i class="bi bi-shield-check me-1"></i>관리자
                      </span>
                    <% else %>
                      <span class="badge" style="background-color: #6e6e73; font-size: 0.85rem;">
                        일반 사용자
                      </span>
                    <% end %>
                  </td>
                  <td class="text-center" style="padding: 1rem;">
                    <span class="badge" style="background-color: #0071e3; font-size: 0.85rem;">
                      <%= user.authorized_devices.active.count %>개
                    </span>
                  </td>
                  <td class="text-center" style="padding: 1rem; color: #6e6e73;">
                    <%= number_with_delimiter(user.sign_in_count) %>
                  </td>
                  <td class="text-center" style="padding: 1rem; color: #6e6e73;">
                    <% if user.current_sign_in_at.present? %>
                      <%= user.current_sign_in_at.strftime('%Y-%m-%d %H:%M') %>
                      <br>
                      <small style="color: #86868b;"><%= user.current_sign_in_ip %></small>
                    <% else %>
                      <span style="color: #c7c7cc;">-</span>
                    <% end %>
                  </td>
                  <td class="text-center" style="padding: 1rem; color: #6e6e73;">
                    <%= user.created_at.strftime('%Y-%m-%d') %>
                  </td>
                  <td class="text-center" style="padding: 1rem;">
                    <div class="btn-group" role="group">
                      <%= link_to admin_user_path(user), class: "btn btn-sm", style: "color: #0071e3; border: 1px solid #0071e3;" do %>
                        <i class="bi bi-eye"></i>
                      <% end %>
                      <%= link_to edit_admin_user_path(user), class: "btn btn-sm", style: "color: #ff9500; border: 1px solid #ff9500;" do %>
                        <i class="bi bi-pencil"></i>
                      <% end %>
                      <% unless user == current_user || (user.admin? && User.admins.count == 1) %>
                        <%= button_to admin_user_path(user), method: :delete, data: { turbo_confirm: "정말 삭제하시겠습니까?" }, class: "btn btn-sm", style: "color: #ff3b30; border: 1px solid #ff3b30; padding: 0.25rem 0.5rem;" do %>
                          <i class="bi bi-trash"></i>
                        <% end %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-inbox" style="font-size: 3rem; color: #c7c7cc;"></i>
          <p class="mt-3 mb-0" style="color: #6e6e73;">등록된 사용자가 없습니다.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
