<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1" style="font-weight: 600; color: #1d1d1f;">
        <%= @user.name %>
        <% if @user.admin? %>
          <span class="badge" style="background-color: #34c759; font-size: 0.7rem; vertical-align: middle;">
            <i class="bi bi-shield-check me-1"></i>관리자
          </span>
        <% end %>
        <% if @user == current_user %>
          <span class="badge bg-info" style="font-size: 0.7rem; vertical-align: middle;">나</span>
        <% end %>
      </h2>
      <p class="text-muted mb-0"><%= @user.email %></p>
    </div>
    <div>
      <%= link_to edit_admin_user_path(@user), class: "btn-apple btn-apple-primary me-2" do %>
        <i class="bi bi-pencil me-2"></i>수정
      <% end %>
      <%= link_to admin_users_path, class: "btn btn-outline-secondary" do %>
        <i class="bi bi-arrow-left me-2"></i>목록으로
      <% end %>
    </div>
  </div>

  <!-- 사용자 정보 -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-size: 0.85rem;">총 로그인</h6>
          <h3 class="mb-0" style="color: #0071e3; font-weight: 600;"><%= number_with_delimiter(@user.sign_in_count) %>회</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-size: 0.85rem;">승인된 디바이스</h6>
          <h3 class="mb-0" style="color: #34c759; font-weight: 600;"><%= @authorized_devices.active.count %>개</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-size: 0.85rem;">마지막 로그인</h6>
          <div style="font-size: 0.9rem; color: #1d1d1f; font-weight: 500;">
            <% if @user.current_sign_in_at.present? %>
              <%= @user.current_sign_in_at.strftime('%Y-%m-%d %H:%M') %>
            <% else %>
              <span style="color: #c7c7cc;">-</span>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-size: 0.85rem;">가입일</h6>
          <div style="font-size: 0.9rem; color: #1d1d1f; font-weight: 500;">
            <%= @user.created_at.strftime('%Y-%m-%d') %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 승인된 디바이스 -->
  <div class="card mb-4" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <div class="card-header" style="background-color: #f5f5f7; border-bottom: 1px solid #e8e8ed; padding: 1rem 1.5rem;">
      <h5 class="mb-0" style="font-weight: 600; color: #1d1d1f;">
        <i class="bi bi-phone me-2" style="color: #0071e3;"></i>
        승인된 디바이스
      </h5>
    </div>
    <div class="card-body p-0">
      <% if @authorized_devices.any? %>
        <div class="table-responsive">
          <table class="table table-hover mb-0" style="font-size: 0.95rem;">
            <thead style="background-color: #f5f5f7; border-bottom: 2px solid #e8e8ed;">
              <tr>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">디바이스</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">브라우저</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">운영체제</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">상태</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">마지막 사용</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">등록일</th>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">작업</th>
              </tr>
            </thead>
            <tbody>
              <% @authorized_devices.each do |device| %>
                <tr>
                  <td style="padding: 1rem;">
                    <div style="font-weight: 500; color: #1d1d1f;">
                      <%= device.display_name %>
                    </div>
                    <small style="color: #86868b; font-family: monospace;">
                      <%= device.fingerprint[0..15] %>...
                    </small>
                  </td>
                  <td style="padding: 1rem; color: #6e6e73;">
                    <i class="bi bi-browser-chrome me-1"></i>
                    <%= device.browser %>
                  </td>
                  <td style="padding: 1rem; color: #6e6e73;">
                    <i class="bi bi-laptop me-1"></i>
                    <%= device.os %>
                  </td>
                  <td class="text-center" style="padding: 1rem;">
                    <% if device.active? %>
                      <span class="badge" style="background-color: #34c759;">
                        <i class="bi bi-check-circle me-1"></i>활성
                      </span>
                    <% else %>
                      <span class="badge" style="background-color: #ff3b30;">
                        <i class="bi bi-x-circle me-1"></i>비활성
                      </span>
                    <% end %>
                  </td>
                  <td class="text-center" style="padding: 1rem; color: #6e6e73;">
                    <% if device.last_used_at.present? %>
                      <%= device.last_used_at.strftime('%Y-%m-%d %H:%M') %>
                    <% else %>
                      <span style="color: #c7c7cc;">-</span>
                    <% end %>
                  </td>
                  <td class="text-center" style="padding: 1rem; color: #6e6e73;">
                    <%= device.created_at.strftime('%Y-%m-%d') %>
                  </td>
                  <td class="text-center" style="padding: 1rem;">
                    <div class="btn-group" role="group">
                      <%= button_to toggle_active_admin_user_authorized_device_path(@user, device), method: :patch, class: "btn btn-sm", style: "color: #ff9500; border: 1px solid #ff9500; padding: 0.25rem 0.5rem;" do %>
                        <i class="bi bi-<%= device.active? ? 'pause' : 'play' %>-circle"></i>
                      <% end %>
                      <%= button_to admin_user_authorized_device_path(@user, device), method: :delete, data: { turbo_confirm: "정말 삭제하시겠습니까?" }, class: "btn btn-sm", style: "color: #ff3b30; border: 1px solid #ff3b30; padding: 0.25rem 0.5rem;" do %>
                        <i class="bi bi-trash"></i>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-phone-x" style="font-size: 3rem; color: #c7c7cc;"></i>
          <p class="mt-3 mb-0" style="color: #6e6e73;">승인된 디바이스가 없습니다.</p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- 최근 로그인 이력 -->
  <div class="card" style="border: 1px solid #e8e8ed; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
    <div class="card-header" style="background-color: #f5f5f7; border-bottom: 1px solid #e8e8ed; padding: 1rem 1.5rem;">
      <h5 class="mb-0" style="font-weight: 600; color: #1d1d1f;">
        <i class="bi bi-clock-history me-2" style="color: #0071e3;"></i>
        최근 로그인 이력 (최근 50건)
      </h5>
    </div>
    <div class="card-body p-0">
      <% if @login_histories.any? %>
        <div class="table-responsive">
          <table class="table table-hover mb-0" style="font-size: 0.95rem;">
            <thead style="background-color: #f5f5f7; border-bottom: 2px solid #e8e8ed;">
              <tr>
                <th class="text-center" style="padding: 1rem; font-weight: 600; color: #1d1d1f;">상태</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">시도 시각</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">IP 주소</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">디바이스</th>
                <th style="padding: 1rem; font-weight: 600; color: #1d1d1f;">실패 사유</th>
              </tr>
            </thead>
            <tbody>
              <% @login_histories.each do |history| %>
                <tr>
                  <td class="text-center" style="padding: 1rem;">
                    <% if history.success? %>
                      <span class="badge" style="background-color: #34c759;">
                        <i class="bi bi-check-circle me-1"></i>성공
                      </span>
                    <% else %>
                      <span class="badge" style="background-color: #ff3b30;">
                        <i class="bi bi-x-circle me-1"></i>실패
                      </span>
                    <% end %>
                  </td>
                  <td style="padding: 1rem; color: #1d1d1f;">
                    <%= history.attempted_at.strftime('%Y-%m-%d %H:%M:%S') %>
                  </td>
                  <td style="padding: 1rem; color: #6e6e73;">
                    <i class="bi bi-geo-alt me-1"></i>
                    <%= history.ip_address %>
                  </td>
                  <td style="padding: 1rem; color: #6e6e73;">
                    <div>
                      <%= history.device_name || "#{history.browser} on #{history.os}" %>
                    </div>
                    <% if history.fingerprint.present? %>
                      <small style="color: #86868b; font-family: monospace;">
                        <%= history.fingerprint[0..15] %>...
                      </small>
                    <% end %>
                  </td>
                  <td style="padding: 1rem; color: #6e6e73;">
                    <% if history.failure_reason.present? %>
                      <span style="color: #ff3b30;">
                        <i class="bi bi-exclamation-triangle me-1"></i>
                        <%= history.failure_reason %>
                      </span>
                    <% else %>
                      <span style="color: #c7c7cc;">-</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-clock-history" style="font-size: 3rem; color: #c7c7cc;"></i>
          <p class="mt-3 mb-0" style="color: #6e6e73;">로그인 이력이 없습니다.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
