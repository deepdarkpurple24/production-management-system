<%= form_with(model: [:inventory, item], local: true, class: "needs-validation") do |f| %>
  <% if item.errors.any? %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <h5 class="alert-heading">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <%= pluralize(item.errors.count, "error") %> 발생
      </h5>
      <ul class="mb-0">
        <% item.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  <% end %>

  <div class="row g-3">
    <!-- 품목코드 (자동생성 안내) -->
    <div class="col-md-6">
      <label class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        품목코드
      </label>
      <div class="form-control bg-light" style="color: #86868b;">
        자동 생성됩니다 (예: ITEM-0001)
      </div>
      <small class="text-muted">품목코드는 시스템에서 자동으로 부여됩니다</small>
    </div>

    <!-- 품목명 -->
    <div class="col-md-6">
      <label for="item_name" class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        품목명 <span class="text-danger">*</span>
      </label>
      <%= f.text_field :name, class: "form-control", placeholder: "예: 밀가루", required: true %>
    </div>

    <!-- 카테고리 -->
    <div class="col-md-6">
      <label for="item_category" class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        카테고리
      </label>
      <%= f.text_field :category, class: "form-control", placeholder: "예: 원자재, 부자재, 완제품 등" %>
    </div>

    <!-- 단위 -->
    <div class="col-md-6">
      <label for="item_unit" class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        단위
      </label>
      <%= f.select :unit,
                   options_for_select(Item::UNITS, item.unit),
                   { include_blank: "선택하세요" },
                   class: "form-select" %>
    </div>

    <!-- 최소재고량 -->
    <div class="col-md-6">
      <label for="item_minimum_stock" class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        최소재고량
      </label>
      <%= f.number_field :minimum_stock,
                         class: "form-control",
                         step: "0.01",
                         placeholder: "0.00",
                         min: "0" %>
      <small class="text-muted">이 수량 이하로 떨어지면 경고가 표시됩니다</small>
    </div>

    <!-- 적정재고량 -->
    <div class="col-md-6">
      <label for="item_optimal_stock" class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        적정재고량
      </label>
      <%= f.number_field :optimal_stock,
                         class: "form-control",
                         step: "0.01",
                         placeholder: "0.00",
                         min: "0" %>
      <small class="text-muted">권장 재고 유지량</small>
    </div>

    <!-- 보관위치 -->
    <div class="col-md-6">
      <label for="item_storage_location" class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        보관위치
      </label>
      <%= f.text_field :storage_location, class: "form-control", placeholder: "예: 창고 A-1" %>
    </div>

    <!-- 제조일로부터 (유통기한 일수) -->
    <div class="col-md-6">
      <label for="item_shelf_life_days" class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        제조일로부터 (일)
        <i class="bi bi-info-circle text-muted"
           data-bs-toggle="tooltip"
           title="입고 시 제조일 입력 시 자동으로 유통기한이 계산됩니다"></i>
      </label>
      <%= f.number_field :shelf_life_days,
                         class: "form-control",
                         placeholder: "예: 365 (1년)",
                         min: "1" %>
      <small class="text-muted">제조일 + 이 일수 = 유통기한 (입고 처리 시 자동 계산)</small>
    </div>

    <!-- 비고 -->
    <div class="col-12">
      <label for="item_notes" class="form-label" style="font-weight: 500; font-size: 0.875rem;">
        비고
      </label>
      <%= f.text_area :notes,
                      class: "form-control",
                      rows: 4,
                      placeholder: "추가 설명이나 특이사항을 입력하세요" %>
    </div>
  </div>

  <!-- 버튼 그룹 -->
  <div class="d-flex gap-2 justify-content-end mt-4 pt-3 border-top">
    <%= link_to "취소", inventory_items_path, class: "btn-apple btn-apple-outline" %>
    <%= f.submit "#{item.new_record? ? '등록' : '수정'}하기", class: "btn-apple btn-apple-primary" %>
  </div>
<% end %>

<!-- Tooltip 초기화 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
  });
</script>
