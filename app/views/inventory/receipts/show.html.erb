<%= render 'inventory/shared/sub_navigation' %>

<div class="container mt-4">
  <!-- 헤더 섹션 -->
  <div class="mb-4">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><%= link_to "재고관리", inventory_path %></li>
        <li class="breadcrumb-item"><%= link_to "입고관리", inventory_receipts_path %></li>
        <li class="breadcrumb-item active" aria-current="page">입고 #<%= @receipt.id %></li>
      </ol>
    </nav>
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="mb-1" style="font-weight: 600; letter-spacing: -0.02em;">입고 상세정보</h2>
        <p class="text-muted small mb-0"><%= @receipt.item.name %> - <%= @receipt.receipt_date.strftime("%Y년 %m월 %d일") %></p>
      </div>
      <div class="d-flex gap-2">
        <%= link_to edit_inventory_receipt_path(@receipt), class: "btn-apple btn-apple-outline" do %>
          <i class="bi bi-pencil me-2"></i>수정
        <% end %>
        <%= button_to inventory_receipt_path(@receipt), method: :delete, data: { turbo_confirm: "정말 삭제하시겠습니까?" }, class: "btn-apple btn-apple-outline text-danger border-danger" do %>
          <i class="bi bi-trash me-2"></i>삭제
        <% end %>
      </div>
    </div>
  </div>

  <!-- 상세 정보 -->
  <div class="row g-4">
    <!-- 품목 정보 -->
    <div class="col-md-6">
      <div class="card-apple h-100">
        <div class="card-body p-4">
          <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">품목 정보</h5>
          <dl class="row mb-0">
            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">품목코드</dt>
            <dd class="col-sm-8 py-2"><code style="background-color: #f5f5f7; padding: 0.25rem 0.5rem; border-radius: 4px;"><%= @receipt.item.item_code %></code></dd>

            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">품목명</dt>
            <dd class="col-sm-8 py-2" style="font-weight: 500;"><%= @receipt.item.name %></dd>

            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">카테고리</dt>
            <dd class="col-sm-8 py-2"><%= @receipt.item.category.present? ? @receipt.item.category : "-" %></dd>

            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">단위</dt>
            <dd class="col-sm-8 py-2"><%= @receipt.item.unit.present? ? @receipt.item.unit : "-" %></dd>
          </dl>
        </div>
      </div>
    </div>

    <!-- 입고 정보 -->
    <div class="col-md-6">
      <div class="card-apple h-100">
        <div class="card-body p-4">
          <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">입고 정보</h5>
          <dl class="row mb-0">
            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">입고일</dt>
            <dd class="col-sm-8 py-2"><%= @receipt.receipt_date.strftime("%Y년 %m월 %d일") %></dd>

            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">수량</dt>
            <dd class="col-sm-8 py-2" style="font-weight: 500;"><%= @receipt.quantity %></dd>

            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">개당 중량</dt>
            <dd class="col-sm-8 py-2">
              <% if @receipt.unit_weight.present? %>
                <%= @receipt.unit_weight %> <%= @receipt.unit_weight_unit.present? ? @receipt.unit_weight_unit : "" %>
              <% else %>
                -
              <% end %>
            </dd>

            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">개당 단가</dt>
            <dd class="col-sm-8 py-2"><%= @receipt.unit_price.present? ? "#{number_to_currency(@receipt.unit_price, unit: '₩', precision: 0)}" : "-" %></dd>

            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">총액</dt>
            <dd class="col-sm-8 py-2">
              <% if @receipt.unit_price.present? %>
                <span style="font-weight: 600; color: #0071e3;"><%= number_to_currency(@receipt.quantity * @receipt.unit_price, unit: '₩', precision: 0) %></span>
              <% else %>
                -
              <% end %>
            </dd>
          </dl>
        </div>
      </div>
    </div>

    <!-- 유통기한 정보 -->
    <div class="col-md-6">
      <div class="card-apple h-100">
        <div class="card-body p-4">
          <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">유통기한 정보</h5>
          <dl class="row mb-0">
            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">제조일</dt>
            <dd class="col-sm-8 py-2">
              <%= @receipt.manufacturing_date ? @receipt.manufacturing_date.strftime("%Y년 %m월 %d일") : "-" %>
            </dd>

            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">유통기한</dt>
            <dd class="col-sm-8 py-2">
              <% if @receipt.expiration_date.present? %>
                <%= @receipt.expiration_date.strftime("%Y년 %m월 %d일") %>
                <% days_remaining = (@receipt.expiration_date - Date.today).to_i %>
                <% if days_remaining < 0 %>
                  <span class="badge bg-danger ms-2">만료됨 (#{days_remaining.abs}일 경과)</span>
                <% elsif days_remaining <= 7 %>
                  <span class="badge bg-warning text-dark ms-2">임박 (D-#{days_remaining})</span>
                <% elsif days_remaining <= 30 %>
                  <span class="badge bg-info text-dark ms-2">D-#{days_remaining}</span>
                <% else %>
                  <span class="badge bg-success ms-2">D-#{days_remaining}</span>
                <% end %>
              <% else %>
                -
              <% end %>
            </dd>

            <% if @receipt.manufacturing_date.present? && @receipt.item.shelf_life_days.present? %>
              <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">보관기간</dt>
              <dd class="col-sm-8 py-2">
                <span class="badge bg-info text-dark"><%= @receipt.item.shelf_life_days %>일</span>
                <small class="text-muted d-block mt-1">제조일 기준 <%= @receipt.item.shelf_life_days %>일 자동 계산됨</small>
              </dd>
            <% end %>
          </dl>
        </div>
      </div>
    </div>

    <!-- 공급업체 정보 -->
    <div class="col-md-6">
      <div class="card-apple h-100">
        <div class="card-body p-4">
          <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">공급업체 정보</h5>
          <dl class="row mb-0">
            <dt class="col-sm-4 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">공급업체</dt>
            <dd class="col-sm-8 py-2"><%= @receipt.supplier.present? ? @receipt.supplier : "-" %></dd>
          </dl>
        </div>
      </div>
    </div>

    <!-- 비고 -->
    <% if @receipt.notes.present? %>
      <div class="col-12">
        <div class="card-apple">
          <div class="card-body p-4">
            <h5 class="card-title mb-3" style="font-weight: 600; font-size: 1.125rem;">비고</h5>
            <p class="mb-0" style="white-space: pre-line;"><%= @receipt.notes %></p>
          </div>
        </div>
      </div>
    <% end %>

    <!-- 시스템 정보 -->
    <div class="col-12">
      <div class="card-apple">
        <div class="card-body p-4">
          <h5 class="card-title mb-3" style="font-weight: 600; font-size: 1.125rem;">시스템 정보</h5>
          <dl class="row mb-0">
            <dt class="col-sm-2 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">등록일시</dt>
            <dd class="col-sm-4 py-2"><%= @receipt.created_at.strftime("%Y년 %m월 %d일 %H:%M") %></dd>

            <dt class="col-sm-2 py-2" style="font-weight: 500; font-size: 0.875rem; color: #86868b;">수정일시</dt>
            <dd class="col-sm-4 py-2"><%= @receipt.updated_at.strftime("%Y년 %m월 %d일 %H:%M") %></dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <!-- 하단 버튼 -->
  <div class="mt-4 pt-3 border-top d-flex justify-content-between">
    <%= link_to inventory_receipts_path, class: "btn-apple btn-apple-outline" do %>
      <i class="bi bi-arrow-left me-2"></i>목록으로
    <% end %>
  </div>
</div>
