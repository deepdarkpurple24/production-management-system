<%
  form_url = @production_log.new_record? ? production_logs_path : production_log_path(@production_log)
  form_method = @production_log.new_record? ? :post : :patch
%>
<%= form_with(model: @production_log, url: form_url, method: form_method, local: true) do |form| %>
  <% if @production_log.errors.any? %>
    <div class="alert alert-danger mb-4" role="alert">
      <h5 class="alert-heading mb-3">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <%= pluralize(@production_log.errors.count, "error") %> prohibited this production log from being saved:
      </h5>
      <ul class="mb-0">
        <% @production_log.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- ìƒì‚° ê³„íš ì„ íƒ (Optional) -->
  <div class="mb-4">
    <%= form.label :production_plan_id, "ìƒì‚° ê³„íš", class: "form-label", style: "font-weight: 500;" %>
    <%= form.select :production_plan_id,
                    options_from_collection_for_select(@production_plans, :id,
                      ->(plan) { "#{plan.finished_product.name} - #{plan.production_date} (#{plan.quantity}ê°œ)" },
                      @production_log.production_plan_id),
                    { prompt: "ìƒì‚° ê³„íš ì„ íƒ (ì„ íƒì‚¬í•­)" },
                    class: "form-select",
                    id: "production_plan_select" %>
    <small class="form-text text-muted">ì‚¬ì „ì— ë“±ë¡í•œ ìƒì‚° ê³„íšì„ ì„ íƒí•˜ë©´ ì™„ì œí’ˆê³¼ ë‚ ì§œê°€ ìë™ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤.</small>
  </div>

  <!-- ì™„ì œí’ˆ ì„ íƒ -->
  <div class="mb-4">
    <%= form.label :finished_product_id, "ì™„ì œí’ˆ", class: "form-label", style: "font-weight: 500;" %>
    <span class="text-danger">*</span>
    <%= form.select :finished_product_id,
                    options_from_collection_for_select(@finished_products, :id, :name, @production_log.finished_product_id),
                    { prompt: "ì™„ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”" },
                    class: "form-select",
                    required: true,
                    id: "finished_product_select" %>
    <small class="form-text text-muted">ìƒì‚°í•œ ì™„ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”.</small>
  </div>

  <!-- ìƒì‚° ì¼ì‹œ -->
  <div class="row mb-4">
    <div class="col-md-6">
      <%= form.label :production_date, "ìƒì‚° ì¼ì", class: "form-label", style: "font-weight: 500;" %>
      <span class="text-danger">*</span>
      <%= form.date_field :production_date,
                          class: "form-control",
                          required: true %>
      <small class="form-text text-muted">ì‹¤ì œ ìƒì‚°í•œ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</small>
    </div>

    <div class="col-md-6">
      <%= form.label :production_time, "ìƒì‚° ì‹œê°„", class: "form-label", style: "font-weight: 500;" %>
      <%= form.time_field :production_time,
                          class: "form-control",
                          placeholder: "ì˜ˆ: 09:00" %>
      <small class="form-text text-muted">ìƒì‚° ì‹œì‘ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­).</small>
    </div>
  </div>

  <!-- ê¸°ë³¸ ë¹„ê³  -->
  <div class="mb-4">
    <%= form.label :notes, "ë¹„ê³ ", class: "form-label", style: "font-weight: 500;" %>
    <%= form.text_area :notes,
                       class: "form-control",
                       rows: 3,
                       placeholder: "ìƒì‚° ê³¼ì • ì¤‘ íŠ¹ì´ì‚¬í•­ì´ë‚˜ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)" %>
  </div>

  <!-- ê¸°ì •ë–¡ ì „ìš© í•„ë“œ ì„¹ì…˜ -->
  <div id="gijeongddeok-fields" style="display: none;">
    <hr class="my-4">
    <h5 class="mb-3" style="color: #1d1d1f; font-weight: 600;">
      <i class="bi bi-clipboard-data me-2"></i>ê¸°ì •ë–¡ ìƒì‚° ìƒì„¸ ì •ë³´
    </h5>

    <!-- ì˜¨ë„ ê´€ë¦¬ -->
    <div class="card mb-3">
      <div class="card-header" style="background-color: #f5f5f7;">
        <h6 class="mb-0" style="font-weight: 500;">ğŸŒ¡ï¸ ì˜¨ë„ ê´€ë¦¬</h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <%= form.label :fermentation_room_temp, "ë°œíš¨ì‹¤ ì˜¨ë„", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :fermentation_room_temp,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 28.5" %>
              <span class="input-group-text">Â°C</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :refrigeration_room_temp, "ëƒ‰ì¥ì‹¤ ì˜¨ë„", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :refrigeration_room_temp,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 4.0" %>
              <span class="input-group-text">Â°C</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :water_temp, "ë¬¼ ì˜¨ë„", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :water_temp,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 25.0" %>
              <span class="input-group-text">Â°C</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :flour_temp, "ê°€ë£¨ ì˜¨ë„", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :flour_temp,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 22.0" %>
              <span class="input-group-text">Â°C</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :porridge_temp, "ì£½ ì˜¨ë„", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :porridge_temp,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 65.0" %>
              <span class="input-group-text">Â°C</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :dough_temp, "ë°˜ì£½ ì˜¨ë„", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :dough_temp,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 27.0" %>
              <span class="input-group-text">Â°C</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì¬ë£Œ íˆ¬ì…ëŸ‰ -->
    <div class="card mb-3">
      <div class="card-header" style="background-color: #f5f5f7;">
        <h6 class="mb-0" style="font-weight: 500;">ğŸ“¦ ì¬ë£Œ íˆ¬ì…ëŸ‰</h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <%= form.label :yeast_amount, "ì´ìŠ¤íŠ¸", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :yeast_amount,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 100" %>
              <span class="input-group-text">g</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :steiva_amount, "ìŠ¤í…Œë¹„ì•„", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :steiva_amount,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 50.5" %>
              <span class="input-group-text">g</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :salt_amount, "ì†Œê¸ˆ", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :salt_amount,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 30" %>
              <span class="input-group-text">g</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :sugar_amount, "ì„¤íƒ•", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :sugar_amount,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 200" %>
              <span class="input-group-text">g</span>
            </div>
          </div>

          <div class="col-md-4">
            <%= form.label :water_amount, "ë¬¼", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :water_amount,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 1.5" %>
              <span class="input-group-text">L</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ë§‰ê±¸ë¦¬ ê´€ë¦¬ -->
    <div class="card mb-3">
      <div class="card-header" style="background-color: #f5f5f7;">
        <h6 class="mb-0" style="font-weight: 500;">ğŸ¶ ë§‰ê±¸ë¦¬ ê´€ë¦¬</h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <%= form.label :makgeolli_consumption, "ë§‰ê±¸ë¦¬ ì†Œë¹„ëŸ‰", class: "form-label" %>
            <div class="input-group">
              <%= form.number_field :makgeolli_consumption,
                                    step: 0.1,
                                    class: "form-control",
                                    placeholder: "ì˜ˆ: 2500" %>
              <span class="input-group-text">mL</span>
            </div>
            <small class="form-text text-muted">ì…ë ¥ ì‹œ ìë™ìœ¼ë¡œ ì¬ê³  ì¶œê³  ì²˜ë¦¬ë©ë‹ˆë‹¤.</small>
          </div>

          <div class="col-md-6">
            <%= form.label :makgeolli_expiry_date, "ë§‰ê±¸ë¦¬ ìœ íš¨ê¸°ê°„", class: "form-label" %>
            <%= form.date_field :makgeolli_expiry_date,
                                class: "form-control" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%= form.hidden_field :view, value: params[:view] %>

  <div class="d-flex justify-content-end gap-2 mt-4">
    <%= form.submit @production_log.new_record? ? "ë“±ë¡" : "ìˆ˜ì •",
                    class: "btn-apple btn-apple-primary" %>
    <%= link_to production_logs_path(view: params[:view] || 'monthly', date: @production_log.production_date || Date.today),
                class: "btn btn-outline-secondary" do %>
      <i class="bi bi-x-lg me-2"></i>ì·¨ì†Œ
    <% end %>
  </div>
<% end %>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const finishedProductSelect = document.getElementById('finished_product_select');
  const gijeongddeokFields = document.getElementById('gijeongddeok-fields');

  // ì™„ì œí’ˆ ì„ íƒ ì‹œ ê¸°ì •ë–¡ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
  function toggleGijeongddeokFields() {
    const selectedOption = finishedProductSelect.options[finishedProductSelect.selectedIndex];
    const productName = selectedOption.text;

    if (productName.includes('ê¸°ì •ë–¡')) {
      gijeongddeokFields.style.display = 'block';
    } else {
      gijeongddeokFields.style.display = 'none';
    }
  }

  // ì´ˆê¸° ë¡œë“œ ì‹œ ì²´í¬
  if (finishedProductSelect.value) {
    toggleGijeongddeokFields();
  }

  // ì™„ì œí’ˆ ì„ íƒ ë³€ê²½ ì‹œ ì²´í¬
  finishedProductSelect.addEventListener('change', toggleGijeongddeokFields);
});
</script>
