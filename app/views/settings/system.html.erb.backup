<div class="container mt-4">
  <!-- í—¤ë” ì„¹ì…˜ -->
  <div class="mb-4">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><%= link_to "í™ˆ", root_path %></li>
        <li class="breadcrumb-item"><%= link_to "ì„¤ì •", settings_path %></li>
        <li class="breadcrumb-item active" aria-current="page">ì‹œìŠ¤í…œ ì„¤ì •</li>
      </ol>
    </nav>
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="mb-1" style="font-weight: 600; letter-spacing: -0.02em;">ì‹œìŠ¤í…œ ì„¤ì •</h2>
        <p class="text-muted small mb-0">System Settings</p>
      </div>
    </div>
  </div>

  <!-- ì„œë¸Œ ë„¤ë¹„ê²Œì´ì…˜ -->
  <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="production-tab" data-bs-toggle="tab" data-bs-target="#production-settings" type="button" role="tab">
        <i class="bi bi-clipboard-data-fill me-2"></i>ìƒì‚°ê´€ë¦¬
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory-settings" type="button" role="tab">
        <i class="bi bi-box-seam-fill me-2"></i>ì¬ê³ ê´€ë¦¬
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="recipe-tab" data-bs-toggle="tab" data-bs-target="#recipe-settings" type="button" role="tab">
        <i class="bi bi-book-fill me-2"></i>ë ˆì‹œí”¼ê´€ë¦¬
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="equipment-tab" data-bs-toggle="tab" data-bs-target="#equipment-settings" type="button" role="tab">
        <i class="bi bi-gear-fill me-2"></i>ê¸°ê¸°ê´€ë¦¬
      </button>
    </li>
  </ul>

  <!-- íƒ­ ì»¨í…ì¸  -->
  <div class="tab-content" id="settingsTabContent">
    <!-- ìƒì‚°ê´€ë¦¬ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade show active" id="production-settings" role="tabpanel">
      <h4 class="mb-4" style="font-weight: 600; color: #1d1d1f;">
        <i class="bi bi-clipboard-data-fill me-2" style="color: #0071e3;"></i>ìƒì‚°ê´€ë¦¬
      </h4>
    <div class="row g-4">
      <!-- ì¥ë¹„ êµ¬ë¶„ ê´€ë¦¬ -->
      <div class="col-12">
        <div class="card-apple">
          <div class="card-body p-4">
            <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">
              <i class="bi bi-tag me-2"></i>ì¥ë¹„ êµ¬ë¶„ ê´€ë¦¬
            </h5>

          <!-- ìƒˆ ì¥ë¹„ êµ¬ë¶„ ì¶”ê°€ í¼ -->
          <%= form_with(model: @equipment_type, url: create_equipment_type_path, local: true, class: "mb-4") do |f| %>
            <div class="input-group">
              <%= f.text_field :name, class: "form-control", placeholder: "ìƒˆ ì¥ë¹„ êµ¬ë¶„ ì…ë ¥ (ì˜ˆ: ì˜¤ë¸, ë¯¹ì„œ ë“±)", required: true %>
              <%= f.submit "ì¶”ê°€", class: "btn-apple btn-apple-primary" %>
            </div>
            <% if @equipment_type.errors.any? %>
              <div class="text-danger small mt-2">
                <%= @equipment_type.errors.full_messages.join(", ") %>
              </div>
            <% end %>
          <% end %>

          <!-- ì¥ë¹„ êµ¬ë¶„ ëª©ë¡ -->
          <% if @equipment_types.any? %>
            <small class="text-muted mb-2 d-block">
              <i class="bi bi-arrows-move me-1"></i>ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½
            </small>
            <div class="list-group" id="equipment-types-list">
              <% @equipment_types.each do |equipment_type| %>
                <div class="list-group-item d-flex justify-content-between align-items-center sortable-item" style="border: 1px solid #e8e8ed; border-radius: 8px; margin-bottom: 8px; cursor: move;" data-id="<%= equipment_type.id %>">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-grip-vertical me-2 text-muted"></i>
                    <span style="font-weight: 500;"><%= equipment_type.name %></span>
                  </div>
                  <%= button_to destroy_equipment_type_path(equipment_type), method: :delete, data: { turbo_confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" }, class: "btn btn-sm btn-outline-danger" do %>
                    <i class="bi bi-trash"></i>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center text-muted py-3">
              <i class="bi bi-inbox" style="font-size: 2rem; color: #d2d2d7;"></i>
              <p class="mt-2 mb-0 small">ë“±ë¡ëœ ì¥ë¹„ êµ¬ë¶„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- ì¥ë¹„ ëª¨ë“œ ê´€ë¦¬ -->
    <div class="col-12">
      <div class="card-apple">
        <div class="card-body p-4">
          <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">
            <i class="bi bi-sliders me-2"></i>ì¥ë¹„ ëª¨ë“œ ê´€ë¦¬
          </h5>

          <!-- ì¥ë¹„ êµ¬ë¶„ ì„ íƒ ë° ëª¨ë“œ ì¶”ê°€ í¼ -->
          <%= form_with(model: @equipment_mode, url: create_equipment_mode_path, local: true, class: "mb-4") do |f| %>
            <div class="row g-2">
              <div class="col-md-4">
                <label class="form-label">ì¥ë¹„ êµ¬ë¶„ ì„ íƒ <span class="text-danger">*</span></label>
                <%= f.select :equipment_type_id,
                             options_for_select(@equipment_types.map { |et| [et.name, et.id] }),
                             { include_blank: "ì„ íƒ" },
                             class: "form-select",
                             id: "equipment-type-select",
                             required: true %>
              </div>
              <div class="col-md-6">
                <label class="form-label">ëª¨ë“œëª… <span class="text-danger">*</span></label>
                <%= f.text_field :name, class: "form-control", placeholder: "ì˜ˆ: ì°œëª¨ë“œ, êµ½ê¸°ëª¨ë“œ ë“±", required: true %>
              </div>
              <div class="col-md-2 d-flex align-items-end">
                <%= f.submit "ì¶”ê°€", class: "btn-apple btn-apple-primary w-100" %>
              </div>
            </div>
            <% if @equipment_mode.errors.any? %>
              <div class="text-danger small mt-2">
                <%= @equipment_mode.errors.full_messages.join(", ") %>
              </div>
            <% end %>
          <% end %>

          <!-- ì¥ë¹„ êµ¬ë¶„ë³„ ëª¨ë“œ ëª©ë¡ í‘œì‹œ -->
          <div id="equipment-modes-container">
            <% if @equipment_types.any? %>
              <% @equipment_types.each do |equipment_type| %>
                <div class="equipment-type-modes mb-4" data-equipment-type-id="<%= equipment_type.id %>" style="display: none;">
                  <h6 class="mb-2" style="font-weight: 500; color: #0071e3;">
                    <i class="bi bi-gear-fill me-1"></i><%= equipment_type.name %> ëª¨ë“œ ëª©ë¡
                  </h6>
                  <% if equipment_type.equipment_modes.any? %>
                    <small class="text-muted mb-2 d-block">
                      <i class="bi bi-arrows-move me-1"></i>ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½
                    </small>
                    <div class="list-group equipment-modes-list" id="equipment-modes-list-<%= equipment_type.id %>">
                      <% equipment_type.equipment_modes.each do |mode| %>
                        <div class="list-group-item d-flex justify-content-between align-items-center sortable-item" style="border: 1px solid #e8e8ed; border-radius: 8px; margin-bottom: 8px; cursor: move;" data-id="<%= mode.id %>">
                          <div class="d-flex align-items-center">
                            <i class="bi bi-grip-vertical me-2 text-muted"></i>
                            <span style="font-weight: 500;"><%= mode.name %></span>
                          </div>
                          <%= button_to destroy_equipment_mode_path(mode), method: :delete, data: { turbo_confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" }, class: "btn btn-sm btn-outline-danger" do %>
                            <i class="bi bi-trash"></i>
                          <% end %>
                        </div>
                      <% end %>
                    </div>
                  <% else %>
                    <div class="text-center text-muted py-2">
                      <small>ë“±ë¡ëœ ëª¨ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</small>
                    </div>
                  <% end %>
                </div>
              <% end %>
            <% else %>
              <div class="text-center text-muted py-3">
                <i class="bi bi-inbox" style="font-size: 2rem; color: #d2d2d7;"></i>
                <p class="mt-2 mb-0 small">ë¨¼ì € ì¥ë¹„ êµ¬ë¶„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
      </div>
    </div>
      </div>
    </div>
    <!-- ë ˆì‹œí”¼ê´€ë¦¬ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade" id="recipe-settings" role="tabpanel">
      <!-- ë ˆì‹œí”¼ê´€ë¦¬ ì„¤ì • -->
      <div class="mb-4">
        <h4 class="mb-3" style="font-weight: 600; color: #1d1d1f;">
          <i class="bi bi-book-fill me-2" style="color: #fd7e14;"></i>ë ˆì‹œí”¼ê´€ë¦¬
        </h4>
        <div class="row g-4">
          <!-- ê³µì • ê´€ë¦¬ -->
          <div class="col-12">
      <div class="card-apple">
        <div class="card-body p-4">
          <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">
            <i class="bi bi-diagram-3 me-2"></i>ê³µì • ê´€ë¦¬
          </h5>

          <!-- ìƒˆ ê³µì • ì¶”ê°€ í¼ -->
          <%= form_with(model: @recipe_process, url: create_recipe_process_path, local: true, class: "mb-4") do |f| %>
            <div class="input-group">
              <%= f.text_field :name, class: "form-control", placeholder: "ìƒˆ ê³µì • ì…ë ¥ (ì˜ˆ: ë°˜ì£½, 1ì°¨ ë°œíš¨, ì„±í˜• ë“±)", required: true %>
              <%= f.submit "ì¶”ê°€", class: "btn-apple btn-apple-primary" %>
            </div>
            <% if @recipe_process.errors.any? %>
              <div class="text-danger small mt-2">
                <%= @recipe_process.errors.full_messages.join(", ") %>
              </div>
            <% end %>
          <% end %>

          <!-- ê³µì • ëª©ë¡ -->
          <% if @recipe_processes.any? %>
            <small class="text-muted mb-2 d-block">
              <i class="bi bi-arrows-move me-1"></i>ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½
            </small>
            <div class="list-group" id="recipe-processes-list">
              <% @recipe_processes.each do |recipe_process| %>
                <div class="list-group-item d-flex justify-content-between align-items-center sortable-item" style="border: 1px solid #e8e8ed; border-radius: 8px; margin-bottom: 8px; cursor: move;" data-id="<%= recipe_process.id %>">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-grip-vertical me-2 text-muted"></i>
                    <span style="font-weight: 500;"><%= recipe_process.name %></span>
                  </div>
                  <%= button_to destroy_recipe_process_path(recipe_process), method: :delete, data: { turbo_confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" }, class: "btn btn-sm btn-outline-danger" do %>
                    <i class="bi bi-trash"></i>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center text-muted py-3">
              <i class="bi bi-inbox" style="font-size: 2rem; color: #d2d2d7;"></i>
              <p class="mt-2 mb-0 small">ë“±ë¡ëœ ê³µì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    </div>
  </div>

      </div>
    </div>
    <!-- í’ˆëª© ê´€ë¦¬ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade" id="item-settings" role="tabpanel">
      <!-- í’ˆëª© ê´€ë¦¬ -->
      <div class="mb-4">
        <h4 class="mb-3" style="font-weight: 600; color: #1d1d1f;">
          <i class="bi bi-tags-fill me-2" style="color: #007bff;"></i>í’ˆëª© ê´€ë¦¬
        </h4>
    <div class="row g-4">
      <div class="col-12">
        <div class="card-apple">
          <div class="card-body p-4">
            <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">
              <i class="bi bi-tag me-2"></i>í’ˆëª© ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
            </h5>

            <!-- ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ -->
            <%= form_with(model: @item_category, url: create_item_category_path, local: true, class: "mb-4") do |f| %>
              <div class="input-group">
                <%= f.text_field :name, class: "form-control", placeholder: "ìƒˆ ì¹´í…Œê³ ë¦¬ ì…ë ¥ (ì˜ˆ: ì›ìì¬, ë¶€ìì¬, ì™„ì œí’ˆ ë“±)", required: true %>
                <%= f.submit "ì¶”ê°€", class: "btn-apple btn-apple-primary" %>
              </div>
              <% if @item_category.errors.any? %>
                <div class="text-danger small mt-2">
                  <%= @item_category.errors.full_messages.join(", ") %>
                </div>
              <% end %>
            <% end %>

            <!-- ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
            <% if @item_categories.any? %>
              <small class="text-muted mb-2 d-block">
                <i class="bi bi-arrows-move me-1"></i>ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½
              </small>
              <div class="list-group" id="item-categories-list">
                <% @item_categories.each do |item_category| %>
                  <div class="list-group-item d-flex justify-content-between align-items-center sortable-item" style="border: 1px solid #e8e8ed; border-radius: 8px; margin-bottom: 8px; cursor: move;" data-id="<%= item_category.id %>">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-grip-vertical me-2 text-muted"></i>
                      <span style="font-weight: 500;"><%= item_category.name %></span>
                    </div>
                    <%= button_to destroy_item_category_path(item_category), method: :delete, data: { turbo_confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" }, class: "btn btn-sm btn-outline-danger" do %>
                      <i class="bi bi-trash"></i>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="text-center text-muted py-3">
                <i class="bi bi-inbox" style="font-size: 2rem; color: #d2d2d7;"></i>
                <p class="mt-2 mb-0 small">ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- ë³´ê´€ìœ„ì¹˜ ê´€ë¦¬ -->
    <div class="row g-4">
      <div class="col-12">
        <div class="card-apple">
          <div class="card-body p-4">
            <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">
              <i class="bi bi-geo-alt me-2"></i>ë³´ê´€ìœ„ì¹˜ ê´€ë¦¬
            </h5>

            <!-- ìƒˆ ë³´ê´€ìœ„ì¹˜ ì¶”ê°€ í¼ -->
            <%= form_with(model: @storage_location, url: create_storage_location_path, local: true, class: "mb-4") do |f| %>
              <div class="input-group">
                <%= f.text_field :name, class: "form-control", placeholder: "ìƒˆ ë³´ê´€ìœ„ì¹˜ ì…ë ¥ (ì˜ˆ: ì°½ê³  A, ëƒ‰ì¥ê³  ë“±)", required: true %>
                <%= f.submit "ì¶”ê°€", class: "btn-apple btn-apple-primary" %>
              </div>
              <% if @storage_location.errors.any? %>
                <div class="text-danger small mt-2">
                  <%= @storage_location.errors.full_messages.join(", ") %>
                </div>
              <% end %>
            <% end %>

            <!-- ë³´ê´€ìœ„ì¹˜ ëª©ë¡ -->
            <% if @storage_locations.any? %>
              <small class="text-muted mb-2 d-block">
                <i class="bi bi-arrows-move me-1"></i>ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½
              </small>
              <div class="list-group" id="storage-locations-list">
                <% @storage_locations.each do |storage_location| %>
                  <div class="list-group-item d-flex justify-content-between align-items-center sortable-item" style="border: 1px solid #e8e8ed; border-radius: 8px; margin-bottom: 8px; cursor: move;" data-id="<%= storage_location.id %>">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-grip-vertical me-2 text-muted"></i>
                      <span style="font-weight: 500;"><%= storage_location.name %></span>
                    </div>
                    <%= button_to destroy_storage_location_path(storage_location), method: :delete, data: { turbo_confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" }, class: "btn btn-sm btn-outline-danger" do %>
                      <i class="bi bi-trash"></i>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="text-center text-muted py-3">
                <i class="bi bi-inbox" style="font-size: 2rem; color: #d2d2d7;"></i>
                <p class="mt-2 mb-0 small">ë“±ë¡ëœ ë³´ê´€ìœ„ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              </div>
            <% end %>
          </div>
        </div>
      </div>
      </div>
    </div>
      </div>
    </div>
    <!-- ì¬ê³ ê´€ë¦¬ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade" id="inventory-settings" role="tabpanel">
      <!-- ì¬ê³ ê´€ë¦¬ ì„¤ì • -->
      <div class="mb-4">
        <h4 class="mb-3" style="font-weight: 600; color: #1d1d1f;">
          <i class="bi bi-box-seam-fill me-2" style="color: #28a745;"></i>ì¬ê³ ê´€ë¦¬
        </h4>
    <div class="row g-4">
      <!-- ì¶œê³  ëª©ì  ê´€ë¦¬ -->
      <div class="col-12">
        <div class="card-apple">
          <div class="card-body p-4">
            <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">
              <i class="bi bi-tag me-2"></i>ì¶œê³  ëª©ì  ê´€ë¦¬
            </h5>

          <!-- ìƒˆ ëª©ì  ì¶”ê°€ í¼ -->
          <%= form_with(model: @shipment_purpose, url: create_shipment_purpose_path, local: true, class: "mb-4") do |f| %>
            <div class="input-group">
              <%= f.text_field :name, class: "form-control", placeholder: "ìƒˆ ì¶œê³  ëª©ì  ì…ë ¥ (ì˜ˆ: ìƒì‚°, íŒë§¤, ìƒ˜í”Œ ë“±)", required: true %>
              <%= f.submit "ì¶”ê°€", class: "btn-apple btn-apple-primary" %>
            </div>
            <% if @shipment_purpose.errors.any? %>
              <div class="text-danger small mt-2">
                <%= @shipment_purpose.errors.full_messages.join(", ") %>
              </div>
            <% end %>
          <% end %>

          <!-- ëª©ì  ëª©ë¡ -->
          <% if @shipment_purposes.any? %>
            <small class="text-muted mb-2 d-block">
              <i class="bi bi-arrows-move me-1"></i>ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½
            </small>
            <div class="list-group" id="purposes-list">
              <% @shipment_purposes.each do |purpose| %>
                <div class="list-group-item d-flex justify-content-between align-items-center sortable-item" style="border: 1px solid #e8e8ed; border-radius: 8px; margin-bottom: 8px; cursor: move;" data-id="<%= purpose.id %>">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-grip-vertical me-2 text-muted"></i>
                    <span style="font-weight: 500;"><%= purpose.name %></span>
                  </div>
                  <%= button_to destroy_shipment_purpose_path(purpose), method: :delete, data: { turbo_confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" }, class: "btn btn-sm btn-outline-danger" do %>
                    <i class="bi bi-trash"></i>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center text-muted py-3">
              <i class="bi bi-inbox" style="font-size: 2rem; color: #d2d2d7;"></i>
              <p class="mt-2 mb-0 small">ë“±ë¡ëœ ì¶œê³  ëª©ì ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- ì¶œê³  ìš”ì²­ì ê´€ë¦¬ -->
    <div class="col-12">
      <div class="card-apple">
        <div class="card-body p-4">
          <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">
            <i class="bi bi-person me-2"></i>ì¶œê³  ìš”ì²­ì ê´€ë¦¬
          </h5>

          <!-- ìƒˆ ìš”ì²­ì ì¶”ê°€ í¼ -->
          <%= form_with(model: @shipment_requester, url: create_shipment_requester_path, local: true, class: "mb-4") do |f| %>
            <div class="input-group">
              <%= f.text_field :name, class: "form-control", placeholder: "ìƒˆ ì¶œê³  ìš”ì²­ì ì…ë ¥ (ì˜ˆ: í™ê¸¸ë™, ìƒì‚°íŒ€ ë“±)", required: true %>
              <%= f.submit "ì¶”ê°€", class: "btn-apple btn-apple-primary" %>
            </div>
            <% if @shipment_requester.errors.any? %>
              <div class="text-danger small mt-2">
                <%= @shipment_requester.errors.full_messages.join(", ") %>
              </div>
            <% end %>
          <% end %>

          <!-- ìš”ì²­ì ëª©ë¡ -->
          <% if @shipment_requesters.any? %>
            <small class="text-muted mb-2 d-block">
              <i class="bi bi-arrows-move me-1"></i>ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½
            </small>
            <div class="list-group" id="requesters-list">
              <% @shipment_requesters.each do |requester| %>
                <div class="list-group-item d-flex justify-content-between align-items-center sortable-item" style="border: 1px solid #e8e8ed; border-radius: 8px; margin-bottom: 8px; cursor: move;" data-id="<%= requester.id %>">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-grip-vertical me-2 text-muted"></i>
                    <span style="font-weight: 500;"><%= requester.name %></span>
                  </div>
                  <%= button_to destroy_shipment_requester_path(requester), method: :delete, data: { turbo_confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" }, class: "btn btn-sm btn-outline-danger" do %>
                    <i class="bi bi-trash"></i>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center text-muted py-3">
              <i class="bi bi-inbox" style="font-size: 2rem; color: #d2d2d7;"></i>
              <p class="mt-2 mb-0 small">ë“±ë¡ëœ ì¶œê³  ìš”ì²­ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          <% end %>
        </div>
      </div>
        </div>
      </div>
      </div>
    </div>
    <!-- ìƒì‚°ê´€ë¦¬ ì„¤ì • íƒ­ -->
    <div class="tab-pane fade" id="production-settings" role="tabpanel">
      <!-- ìƒì‚°ê´€ë¦¬ ì„¤ì • -->
      <div class="mb-4">
        <h4 class="mb-3" style="font-weight: 600; color: #1d1d1f;">
          <i class="bi bi-clipboard-data-fill me-2" style="color: #0071e3;"></i>ìƒì‚°ê´€ë¦¬
        </h4>
    <div class="row g-4">
      <!-- ê¸°ì •ë–¡ ê¸°ë³¸ê°’ ì„¤ì • -->
      <div class="col-12">
        <div class="card-apple">
          <div class="card-body p-4">
            <h5 class="card-title mb-4" style="font-weight: 600; font-size: 1.125rem;">
              <i class="bi bi-clipboard-check me-2"></i>ê¸°ì •ë–¡ ìƒì‚°ì¼ì§€ ê¸°ë³¸ê°’ ì„¤ì •
            </h5>
            <p class="text-muted small mb-4">
              ê¸°ì •ë–¡ ìƒì‚°ì¼ì§€ ì…ë ¥ ì‹œ ìë™ìœ¼ë¡œ ì±„ì›Œì§ˆ ê¸°ë³¸ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤. ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>

            <!-- í•„ë“œ ìˆœì„œ ë¦¬ìŠ¤íŠ¸ -->
            <div id="gijeongddeok-fields-list" class="mb-4">
              <% @gijeongddeok_fields.each do |field| %>
                <div class="sortable-item p-3 mb-2"
                     data-id="<%= field.id %>"
                     style="background: #f5f5f7; border-radius: 8px; cursor: move; border: 1px solid #e5e5e7;">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-grip-vertical me-3" style="color: #86868b;"></i>
                    <div class="flex-grow-1">
                      <strong><%= field.label %></strong>
                      <small class="text-muted ms-2">(<%= field.field_name %>)</small>
                    </div>
                    <span class="badge bg-secondary"><%= field.category == 'temperature' ? 'ì˜¨ë„' : field.category == 'ingredient' ? 'ì¬ë£Œ' : 'ë§‰ê±¸ë¦¬' %></span>
                  </div>
                </div>
              <% end %>
            </div>

            <%= form_with(model: @gijeongddeok_default, url: update_gijeongddeok_defaults_path, method: :patch, id: "gijeongddeok-form", local: true) do |f| %>
              <h6 class="mb-3" style="font-weight: 600; color: #1d1d1f;">ğŸ“ ê¸°ë³¸ê°’ ì…ë ¥</h6>
              <div class="row g-3 mb-4">
                <% @gijeongddeok_fields.each do |field| %>
                  <div class="col-md-4">
                    <%= f.label field.field_name, field.label, class: "form-label" %>
                    <div class="input-group">
                      <%= f.number_field field.field_name,
                                        step: (field.field_name.ends_with?('_temp') || field.field_name.ends_with?('_amount') && field.field_name != 'yeast_amount' && field.field_name != 'salt_amount' && field.field_name != 'sugar_amount') ? 0.1 : nil,
                                        class: "form-control",
                                        placeholder: field.category == 'temperature' ? "ì˜ˆ: 25.0" : (field.field_name == 'makgeolli_consumption' ? "ì˜ˆ: 2500" : (field.field_name == 'water_amount' ? "ì˜ˆ: 1.5" : "ì˜ˆ: 100")) %>
                      <span class="input-group-text">
                        <%= case field.field_name
                            when /temp$/
                              'Â°C'
                            when 'yeast_amount', 'salt_amount', 'sugar_amount', 'steiva_amount'
                              'g'
                            when 'water_amount'
                              'L'
                            when 'makgeolli_consumption'
                              'mL'
                            else
                              ''
                            end %>
                      </span>
                    </div>
                  </div>
                <% end %>
              </div>

              <div class="d-flex justify-content-end">
                <%= f.submit "ì €ì¥", class: "btn-apple btn-apple-primary" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- í•˜ë‹¨ ë²„íŠ¼ -->
  <div class="mt-4 pt-3 border-top d-flex justify-content-between">
    <%= link_to settings_path, class: "btn-apple btn-apple-outline" do %>
      <i class="bi bi-arrow-left me-2"></i>ì„¤ì •ìœ¼ë¡œ
    <% end %>
      </div>
    </div>
  </div>
</div>

<!-- SortableJS ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<script>
  document.addEventListener('turbo:load', function() {
    // Sortableì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ëŒ€ê¸°
    if (typeof Sortable === 'undefined') {
      console.warn('Sortable ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      return;
    }

    // ì¥ë¹„ êµ¬ë¶„ ì„ íƒ ì‹œ í•´ë‹¹ ëª¨ë“œ ëª©ë¡ í‘œì‹œ
    var equipmentTypeSelect = document.getElementById('equipment-type-select');
    if (equipmentTypeSelect) {
      equipmentTypeSelect.addEventListener('change', function() {
        var selectedTypeId = this.value;

        // ëª¨ë“  ëª¨ë“œ ëª©ë¡ ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.equipment-type-modes').forEach(function(element) {
          element.style.display = 'none';
        });

        // ì„ íƒëœ ì¥ë¹„ êµ¬ë¶„ì˜ ëª¨ë“œ ëª©ë¡ë§Œ í‘œì‹œ
        if (selectedTypeId) {
          var selectedModesList = document.querySelector('.equipment-type-modes[data-equipment-type-id="' + selectedTypeId + '"]');
          if (selectedModesList) {
            selectedModesList.style.display = 'block';
          }
        }
      });
    }

    // ì¥ë¹„ ëª¨ë“œ ëª©ë¡ ë“œë˜ê·¸ ì•¤ ë“œë¡­
    document.querySelectorAll('.equipment-modes-list').forEach(function(modesList) {
      if (modesList && !modesList.hasAttribute('data-sortable-initialized')) {
        modesList.setAttribute('data-sortable-initialized', 'true');
        Sortable.create(modesList, {
          animation: 150,
          handle: '.sortable-item',
          ghostClass: 'sortable-ghost',
          onEnd: function(evt) {
            var positions = [];
            var items = modesList.querySelectorAll('.sortable-item');
            items.forEach(function(item) {
              positions.push(item.dataset.id);
            });

            // ì„œë²„ì— ìˆœì„œ ì—…ë°ì´íŠ¸ ìš”ì²­
            fetch('<%= update_equipment_mode_positions_path %>', {
              method: 'PATCH',
              headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
              },
              body: JSON.stringify({ positions: positions })
            })
            .then(response => {
              if (response.ok) {
                console.log('ì¥ë¹„ ëª¨ë“œ ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
              }
            })
            .catch(error => {
              console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', error);
            });
          }
        });
      }
    });

    // ì¥ë¹„ êµ¬ë¶„ ëª©ë¡ ë“œë˜ê·¸ ì•¤ ë“œë¡­
    var equipmentTypesList = document.getElementById('equipment-types-list');
    if (equipmentTypesList && !equipmentTypesList.hasAttribute('data-sortable-initialized')) {
      equipmentTypesList.setAttribute('data-sortable-initialized', 'true');
      var equipmentTypesSortable = Sortable.create(equipmentTypesList, {
        animation: 150,
        handle: '.sortable-item',
        ghostClass: 'sortable-ghost',
        onEnd: function(evt) {
          var positions = [];
          var items = equipmentTypesList.querySelectorAll('.sortable-item');
          items.forEach(function(item) {
            positions.push(item.dataset.id);
          });

          // ì„œë²„ì— ìˆœì„œ ì—…ë°ì´íŠ¸ ìš”ì²­
          fetch('<%= update_equipment_type_positions_path %>', {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
            },
            body: JSON.stringify({ positions: positions })
          })
          .then(response => {
            if (response.ok) {
              console.log('ì¥ë¹„ êµ¬ë¶„ ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          })
          .catch(error => {
            console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', error);
          });
        }
      });
    }

    // ì¶œê³  ëª©ì  ëª©ë¡ ë“œë˜ê·¸ ì•¤ ë“œë¡­
    var purposesList = document.getElementById('purposes-list');
    if (purposesList && !purposesList.hasAttribute('data-sortable-initialized')) {
      purposesList.setAttribute('data-sortable-initialized', 'true');
      var purposesSortable = Sortable.create(purposesList, {
        animation: 150,
        handle: '.sortable-item',
        ghostClass: 'sortable-ghost',
        onEnd: function(evt) {
          var positions = [];
          var items = purposesList.querySelectorAll('.sortable-item');
          items.forEach(function(item) {
            positions.push(item.dataset.id);
          });

          // ì„œë²„ì— ìˆœì„œ ì—…ë°ì´íŠ¸ ìš”ì²­
          fetch('<%= update_purpose_positions_path %>', {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
            },
            body: JSON.stringify({ positions: positions })
          })
          .then(response => {
            if (response.ok) {
              console.log('ì¶œê³  ëª©ì  ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          })
          .catch(error => {
            console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', error);
          });
        }
      });
    }

    // ì¶œê³  ìš”ì²­ì ëª©ë¡ ë“œë˜ê·¸ ì•¤ ë“œë¡­
    var requestersList = document.getElementById('requesters-list');
    if (requestersList && !requestersList.hasAttribute('data-sortable-initialized')) {
      requestersList.setAttribute('data-sortable-initialized', 'true');
      var requestersSortable = Sortable.create(requestersList, {
        animation: 150,
        handle: '.sortable-item',
        ghostClass: 'sortable-ghost',
        onEnd: function(evt) {
          var positions = [];
          var items = requestersList.querySelectorAll('.sortable-item');
          items.forEach(function(item) {
            positions.push(item.dataset.id);
          });

          // ì„œë²„ì— ìˆœì„œ ì—…ë°ì´íŠ¸ ìš”ì²­
          fetch('<%= update_requester_positions_path %>', {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
            },
            body: JSON.stringify({ positions: positions })
          })
          .then(response => {
            if (response.ok) {
              console.log('ì¶œê³  ìš”ì²­ì ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          })
          .catch(error => {
            console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', error);
          });
        }
      });
    }

    // ê³µì • ëª©ë¡ ë“œë˜ê·¸ ì•¤ ë“œë¡­
    var recipeProcessesList = document.getElementById('recipe-processes-list');
    if (recipeProcessesList && !recipeProcessesList.hasAttribute('data-sortable-initialized')) {
      recipeProcessesList.setAttribute('data-sortable-initialized', 'true');
      var recipeProcessesSortable = Sortable.create(recipeProcessesList, {
        animation: 150,
        handle: '.sortable-item',
        ghostClass: 'sortable-ghost',
        onEnd: function(evt) {
          var positions = [];
          var items = recipeProcessesList.querySelectorAll('.sortable-item');
          items.forEach(function(item) {
            positions.push(item.dataset.id);
          });

          // ì„œë²„ì— ìˆœì„œ ì—…ë°ì´íŠ¸ ìš”ì²­
          fetch('<%= update_recipe_process_positions_path %>', {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
            },
            body: JSON.stringify({ positions: positions })
          })
          .then(response => {
            if (response.ok) {
              console.log('ê³µì • ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          })
          .catch(error => {
            console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', error);
          });
        }
      });
    }

    // ë³´ê´€ìœ„ì¹˜ ëª©ë¡ ë“œë˜ê·¸ ì•¤ ë“œë¡­
    var storageLocationsList = document.getElementById('storage-locations-list');
    if (storageLocationsList && !storageLocationsList.hasAttribute('data-sortable-initialized')) {
      storageLocationsList.setAttribute('data-sortable-initialized', 'true');
      var storageLocationsSortable = Sortable.create(storageLocationsList, {
        animation: 150,
        handle: '.sortable-item',
        ghostClass: 'sortable-ghost',
        onEnd: function(evt) {
          var positions = [];
          var items = storageLocationsList.querySelectorAll('.sortable-item');
          items.forEach(function(item) {
            positions.push(item.dataset.id);
          });

          // ì„œë²„ì— ìˆœì„œ ì—…ë°ì´íŠ¸ ìš”ì²­
          fetch('<%= update_storage_location_positions_path %>', {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
            },
            body: JSON.stringify({ positions: positions })
          })
          .then(response => {
            if (response.ok) {
              console.log('ë³´ê´€ìœ„ì¹˜ ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          })
          .catch(error => {
            console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', error);
          });
        }
      });
    }

    // í’ˆëª© ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë“œë˜ê·¸ ì•¤ ë“œë¡­
    var itemCategoriesList = document.getElementById('item-categories-list');
    if (itemCategoriesList && !itemCategoriesList.hasAttribute('data-sortable-initialized')) {
      itemCategoriesList.setAttribute('data-sortable-initialized', 'true');
      var itemCategoriesSortable = Sortable.create(itemCategoriesList, {
        animation: 150,
        handle: '.sortable-item',
        ghostClass: 'sortable-ghost',
        onEnd: function(evt) {
          var positions = [];
          var items = itemCategoriesList.querySelectorAll('.sortable-item');
          items.forEach(function(item) {
            positions.push(item.dataset.id);
          });

          // ì„œë²„ì— ìˆœì„œ ì—…ë°ì´íŠ¸ ìš”ì²­
          fetch('<%= update_item_category_positions_path %>', {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
            },
            body: JSON.stringify({ positions: positions })
          })
          .then(response => {
            if (response.ok) {
              console.log('í’ˆëª© ì¹´í…Œê³ ë¦¬ ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          })
          .catch(error => {
            console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', error);
          });
        }
      });
    }

    // ê¸°ì •ë–¡ í•„ë“œ ëª©ë¡ ë“œë˜ê·¸ ì•¤ ë“œë¡­
    var gijeongddeokFieldsList = document.getElementById('gijeongddeok-fields-list');
    if (gijeongddeokFieldsList && !gijeongddeokFieldsList.hasAttribute('data-sortable-initialized')) {
      gijeongddeokFieldsList.setAttribute('data-sortable-initialized', 'true');
      var gijeongddeokFieldsSortable = Sortable.create(gijeongddeokFieldsList, {
        animation: 150,
        handle: '.sortable-item',
        ghostClass: 'sortable-ghost',
        onEnd: function(evt) {
          var positions = [];
          var items = gijeongddeokFieldsList.querySelectorAll('.sortable-item');
          items.forEach(function(item) {
            positions.push(item.dataset.id);
          });

          // ì„œë²„ì— ìˆœì„œ ì—…ë°ì´íŠ¸ ìš”ì²­
          fetch('<%= update_gijeongddeok_field_positions_path %>', {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
            },
            body: JSON.stringify({ positions: positions })
          })
          .then(response => {
            if (response.ok) {
              console.log('ê¸°ì •ë–¡ í•„ë“œ ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
              // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ê¸°ë³¸ê°’ ì…ë ¥ í¼ë„ ìˆœì„œëŒ€ë¡œ ì¬ì •ë ¬
              location.reload();
            }
          })
          .catch(error => {
            console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', error);
          });
        }
      });
    }
  });
</script>

<style>
  /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
  #settingsTabs {
    border-bottom: 2px solid #e8e8ed;
    margin-bottom: 2rem;
  }

  #settingsTabs .nav-link {
    color: #1d1d1f;
    border: none;
    border-bottom: 3px solid transparent;
    padding: 0.75rem 1.25rem;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  #settingsTabs .nav-link:hover {
    color: #0071e3;
    border-bottom-color: #0071e3;
    background-color: transparent;
  }

  #settingsTabs .nav-link.active {
    color: #0071e3;
    border-bottom-color: #0071e3;
    background-color: transparent;
  }

  #settingsTabs .nav-link i {
    font-size: 1rem;
  }

  .sortable-ghost {
    opacity: 0.4;
    background: #f5f5f7;
  }

  .sortable-item:hover {
    background-color: #fafafa;
  }
</style>
